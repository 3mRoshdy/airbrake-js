this.airbrakeJs=this.airbrakeJs||{},this.airbrakeJs.Client=function(){"use strict";function t(t){var e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return r})},function(r){return e.resolve(t()).then(function(){return e.reject(r)})})}var e=setTimeout;function r(t){return Boolean(t&&void 0!==t.length)}function n(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],h(t,this)}function i(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,o._immediateFn(function(){var r=1===t._state?e.onFulfilled:e.onRejected;if(null!==r){var n;try{n=r(t._value)}catch(t){return void a(e.promise,t)}s(e.promise,n)}else(1===t._state?s:a)(e.promise,t._value)})):t._deferreds.push(e)}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof o)return t._state=3,t._value=e,void u(t);if("function"==typeof r)return void h((n=r,i=e,function(){n.apply(i,arguments)}),t)}t._state=1,t._value=e,u(t)}catch(e){a(t,e)}var n,i}function a(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,r=t._deferreds.length;e<r;e++)i(t,t._deferreds[e]);t._deferreds=null}function c(t,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=r}function h(t,e){var r=!1;try{t(function(t){r||(r=!0,s(e,t))},function(t){r||(r=!0,a(e,t))})}catch(t){if(r)return;r=!0,a(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var r=new this.constructor(n);return i(this,new c(t,e,r)),r},o.prototype.finally=t,o.all=function(t){return new o(function(e,n){if(!r(t))return n(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(t);if(0===o.length)return e([]);var i=o.length;function s(t,r){try{if(r&&("object"==typeof r||"function"==typeof r)){var a=r.then;if("function"==typeof a)return void a.call(r,function(e){s(t,e)},n)}o[t]=r,0==--i&&e(o)}catch(t){n(t)}}for(var a=0;a<o.length;a++)s(a,o[a])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,r){r(t)})},o.race=function(t){return new o(function(e,n){if(!r(t))return n(new TypeError("Promise.race accepts an array"));for(var i=0,s=t.length;i<s;i++)o.resolve(t[i]).then(e,n)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){e(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var f=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"Promise"in f?f.Promise.prototype.finally||(f.Promise.prototype.finally=t):f.Promise=o;var p=function(){return(p=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},l=128;function d(t,e){return t>>e||1}var y=function(){function t(t){this.maxStringLength=1024,this.maxObjectLength=l,this.maxArrayLength=l,this.maxDepth=8,this.keys=[],this.keysBlacklist=[],this.seen=[];var e=t.level||0;this.keysBlacklist=t.keysBlacklist||[],this.maxStringLength=d(this.maxStringLength,e),this.maxObjectLength=d(this.maxObjectLength,e),this.maxArrayLength=d(this.maxArrayLength,e),this.maxDepth=d(this.maxDepth,e)}return t.prototype.truncate=function(t,e,r){if(void 0===e&&(e=""),void 0===r&&(r=0),null==t)return t;switch(typeof t){case"boolean":case"number":case"function":return t;case"string":return this.truncateString(t);case"object":break;default:return this.truncateString(String(t))}if(t instanceof String)return this.truncateString(t.toString());if(t instanceof Boolean||t instanceof Number||t instanceof Date||t instanceof RegExp)return t;if(t instanceof Error)return this.truncateString(t.toString());if(this.seen.indexOf(t)>=0)return"[Circular "+this.getPath(t)+"]";var n=function(t){return Object.prototype.toString.apply(t).slice("[object ".length,-1)}(t);if(++r>this.maxDepth)return"[Truncated "+n+"]";switch(this.keys.push(e),this.seen.push(t),n){case"Array":return this.truncateArray(t,r);case"Object":return this.truncateObject(t,r);default:var o=this.maxDepth;this.maxDepth=0;var i=this.truncateObject(t,r);return i.__type=n,this.maxDepth=o,i}},t.prototype.getPath=function(t){for(var e=this.seen.indexOf(t),r=[this.keys[e]],n=e;n>=0;n--){var o=this.seen[n];o&&v(o,r[0])===t&&(t=o,r.unshift(this.keys[n]))}return"~"+r.join(".")},t.prototype.truncateString=function(t){return t.length>this.maxStringLength?t.slice(0,this.maxStringLength)+"...":t},t.prototype.truncateArray=function(t,e){void 0===e&&(e=0);for(var r=0,n=[],o=0;o<t.length;o++){var i=t[o];if(n.push(this.truncate(i,o.toString(),e)),++r>=this.maxArrayLength)break}return n},t.prototype.truncateObject=function(t,e){void 0===e&&(e=0);var r=0,n={};for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))if(g(o,this.keysBlacklist))n[o]="[Filtered]";else{var i=v(t,o);if(void 0!==i&&"function"!=typeof i&&(n[o]=this.truncate(i,o,e),++r>=this.maxObjectLength))break}return n},t}();function m(t,e){return void 0===e&&(e={}),new y(e).truncate(t)}function v(t,e){try{return t[e]}catch(t){return}}function g(t,e){for(var r=0,n=e;r<n.length;r++){var o=n[r];if(o===t)return!0;if(o instanceof RegExp&&t.match(o))return!0}return!1}var w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var x=b(function(t,e){t.exports=function(){function t(t){return!isNaN(parseFloat(t))&&isFinite(t)}function e(t){return t.charAt(0).toUpperCase()+t.substring(1)}function r(t){return function(){return this[t]}}var n=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],i=["fileName","functionName","source"],s=n.concat(o,i,["args"]);function a(t){if(t instanceof Object)for(var r=0;r<s.length;r++)t.hasOwnProperty(s[r])&&void 0!==t[s[r]]&&this["set"+e(s[r])](t[s[r]])}a.prototype={getArgs:function(){return this.args},setArgs:function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("Args must be an Array");this.args=t},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(t){if(t instanceof a)this.evalOrigin=t;else{if(!(t instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new a(t)}},toString:function(){var e=this.getFunctionName()||"{anonymous}",r="("+(this.getArgs()||[]).join(",")+")",n=this.getFileName()?"@"+this.getFileName():"",o=t(this.getLineNumber())?":"+this.getLineNumber():"",i=t(this.getColumnNumber())?":"+this.getColumnNumber():"";return e+r+n+o+i}};for(var u=0;u<n.length;u++)a.prototype["get"+e(n[u])]=r(n[u]),a.prototype["set"+e(n[u])]=function(t){return function(e){this[t]=Boolean(e)}}(n[u]);for(var c=0;c<o.length;c++)a.prototype["get"+e(o[c])]=r(o[c]),a.prototype["set"+e(o[c])]=function(e){return function(r){if(!t(r))throw new TypeError(e+" must be a Number");this[e]=Number(r)}}(o[c]);for(var h=0;h<i.length;h++)a.prototype["get"+e(i[h])]=r(i[h]),a.prototype["set"+e(i[h])]=function(t){return function(e){this[t]=String(e)}}(i[h]);return a}()}),E=b(function(t,e){var r,n,o,i;t.exports=(r=x,n=/(^|@)\S+\:\d+/,o=/^\s*at .*(\S+\:\d+|\(native\))/m,i=/^(eval@)?(\[native code\])?$/,{parse:function(t){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return this.parseOpera(t);if(t.stack&&t.stack.match(o))return this.parseV8OrIE(t);if(t.stack)return this.parseFFOrSafari(t);throw new Error("Cannot parse given Error object")},extractLocation:function(t){if(-1===t.indexOf(":"))return[t];var e=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(t.replace(/[\(\)]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]},parseV8OrIE:function(t){var e=t.stack.split("\n").filter(function(t){return!!t.match(o)},this);return e.map(function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var e=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),n=this.extractLocation(e.pop()),o=e.join(" ")||void 0,i=["eval","<anonymous>"].indexOf(n[0])>-1?void 0:n[0];return new r({functionName:o,fileName:i,lineNumber:n[1],columnNumber:n[2],source:t})},this)},parseFFOrSafari:function(t){var e=t.stack.split("\n").filter(function(t){return!t.match(i)},this);return e.map(function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new r({functionName:t});var e=/((.*".+"[^@]*)?[^@]*)(?:@)/,n=t.match(e),o=n&&n[1]?n[1]:void 0,i=this.extractLocation(t.replace(e,""));return new r({functionName:o,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:t})},this)},parseOpera:function(t){return!t.stacktrace||t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length?this.parseOpera9(t):t.stack?this.parseOpera11(t):this.parseOpera10(t)},parseOpera9:function(t){for(var e=/Line (\d+).*script (?:in )?(\S+)/i,n=t.message.split("\n"),o=[],i=2,s=n.length;i<s;i+=2){var a=e.exec(n[i]);a&&o.push(new r({fileName:a[2],lineNumber:a[1],source:n[i]}))}return o},parseOpera10:function(t){for(var e=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,n=t.stacktrace.split("\n"),o=[],i=0,s=n.length;i<s;i+=2){var a=e.exec(n[i]);a&&o.push(new r({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:n[i]}))}return o},parseOpera11:function(t){var e=t.stack.split("\n").filter(function(t){return!!t.match(n)&&!t.match(/^Error created at/)},this);return e.map(function(t){var e,n=t.split("@"),o=this.extractLocation(n.pop()),i=n.shift()||"",s=i.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;i.match(/\(([^\)]*)\)/)&&(e=i.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var a=void 0===e||"[arguments not available]"===e?void 0:e.split(",");return new r({functionName:s,args:a,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:t})},this)}})}),O="object"==typeof console&&console.warn;function j(t){try{return E.parse(t)}catch(e){O&&t.stack&&console.warn("ErrorStackParser:",e.toString(),t.stack)}return t.fileName?[t]:[]}function _(t){var e=[];if(t.noStack)e.push({function:t.functionName||"",file:t.fileName||"",line:t.lineNumber||0,column:t.columnNumber||0});else{var r=j(t);if(0===r.length)try{throw new Error("fake")}catch(t){(r=j(t)).shift(),r.shift()}for(var n=0,o=r;n<o.length;n++){var i=o[n];e.push({function:i.functionName||"",file:i.fileName||"",line:i.lineNumber||0,column:i.columnNumber||0})}}return{type:t.name?t.name:"",message:t.message?String(t.message):String(t),backtrace:e}}var k=new RegExp(["^","\\[(\\$.+)\\]","\\s","([\\s\\S]+)","$"].join(""));function N(t){var e=t.errors[0];if(""!==e.type&&"Error"!==e.type)return t;var r=e.message.match(k);return null!==r&&(e.type=r[1],e.message=r[2]),t}var S=["Script error","Script error.","InvalidAccessError"];function L(t){var e=t.errors[0];if(""===e.type&&-1!==S.indexOf(e.message))return null;if(e.backtrace&&e.backtrace.length>0&&"<anonymous>"===e.backtrace[0].file)return null;return t}function A(t){var e;try{e=require("os")}catch(t){}return e&&(t.context.os=e.type()+"/"+e.release(),t.context.architecture=e.arch(),t.context.hostname=e.hostname(),t.params.os={homedir:e.homedir(),uptime:e.uptime(),freemem:e.freemem(),totalmem:e.totalmem(),loadavg:e.loadavg()}),process&&(t.context.platform=process.platform,t.context.rootDirectory||(t.context.rootDirectory=process.cwd()),t.params.process={pid:process.pid,cwd:process.cwd(),execPath:process.execPath,argv:process.argv},["uptime","cpuUsage","memoryUsage"].map(function(e){process[e]&&(t.params.process[e]=process[e]())})),t}var T=new RegExp(["^","Uncaught\\s","(.+?)",":\\s","(.+)","$"].join(""));function D(t){var e=t.errors[0];if(""!==e.type&&"Error"!==e.type)return t;var r=e.message.match(T);return null!==r&&(e.type=r[1],e.message=r[2]),t}function P(t){return window.navigator&&window.navigator.userAgent&&(t.context.userAgent=window.navigator.userAgent),window.location&&(t.context.url=String(window.location),t.context.rootDirectory=window.location.protocol+"//"+window.location.host),t}var R=b(function(t,e){var r=function(t){function e(){this.fetch=!1,this.DOMException=t.DOMException}return e.prototype=t,new e}("undefined"!=typeof self?self:w);!function(t){!function(e){var r={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(r.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(t){return t&&n.indexOf(Object.prototype.toString.call(t))>-1};function i(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function s(t){return"string"!=typeof t&&(t=String(t)),t}function a(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return r.iterable&&(e[Symbol.iterator]=function(){return e}),e}function u(t){this.map={},t instanceof u?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function c(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function h(t){return new Promise(function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}})}function f(t){var e=new FileReader,r=h(e);return e.readAsArrayBuffer(t),r}function p(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function l(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:r.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:r.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():r.arrayBuffer&&r.blob&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=p(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||o(t))?this._bodyArrayBuffer=p(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var t=c(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?c(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var t,e,r,n=c(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,r=h(e),e.readAsText(t),r;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}u.prototype.append=function(t,e){t=i(t),e=s(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},u.prototype.delete=function(t){delete this.map[i(t)]},u.prototype.get=function(t){return t=i(t),this.has(t)?this.map[t]:null},u.prototype.has=function(t){return this.map.hasOwnProperty(i(t))},u.prototype.set=function(t,e){this.map[i(t)]=s(e)},u.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},u.prototype.keys=function(){var t=[];return this.forEach(function(e,r){t.push(r)}),a(t)},u.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),a(t)},u.prototype.entries=function(){var t=[];return this.forEach(function(e,r){t.push([r,e])}),a(t)},r.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var d=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function y(t,e){var r,n,o=(e=e||{}).body;if(t instanceof y){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new u(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,o||null==t._bodyInit||(o=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new u(e.headers)),this.method=(r=e.method||this.method||"GET",n=r.toUpperCase(),d.indexOf(n)>-1?n:r),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function m(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(o))}}),e}function v(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new u(e.headers),this.url=e.url||"",this._initBody(t)}y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},l.call(y.prototype),l.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},v.error=function(){var t=new v(null,{status:0,statusText:""});return t.type="error",t};var g=[301,302,303,307,308];v.redirect=function(t,e){if(-1===g.indexOf(e))throw new RangeError("Invalid status code");return new v(null,{status:e,headers:{location:t}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function w(t,n){return new Promise(function(o,i){var s=new y(t,n);if(s.signal&&s.signal.aborted)return i(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function c(){a.abort()}a.onload=function(){var t,e,r={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new u,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var r=t.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();e.append(n,o)}}),e)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var n="response"in a?a.response:a.responseText;o(new v(n,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new e.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&r.blob&&(a.responseType="blob"),s.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),s.signal&&(s.signal.addEventListener("abort",c),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",c)}),a.send(void 0===s._bodyInit?null:s._bodyInit)})}w.polyfill=!0,t.fetch||(t.fetch=w,t.Headers=u,t.Request=y,t.Response=v),e.Headers=u,e.Request=y,e.Response=v,e.fetch=w}({})}(r),delete r.fetch.polyfill,(e=r.fetch).default=r.fetch,e.fetch=r.fetch,e.Headers=r.Headers,e.Request=r.Request,e.Response=r.Response,t.exports=e}),B=(R.fetch,R.Headers,R.Request,R.Response,{unauthorized:new Error("airbrake: unauthorized: project id or key are wrong"),ipRateLimited:new Error("airbrake: IP is rate limited")}),F=0;function C(t){if(Date.now()/1e3<F)return Promise.reject(B.ipRateLimited);var e={method:t.method,body:t.body};return R(t.url,e).then(function(t){if(401===t.status)throw B.unauthorized;if(429===t.status){var e=t.headers.get("X-RateLimit-Delay");if(!e)throw B.ipRateLimited;var r=parseInt(e,10);throw r>0&&(F=Date.now()/1e3+r),B.ipRateLimited}return 204===t.status?{json:null}:t.status>=200&&t.status<300?t.json().then(function(t){return{json:t}}):t.status>=400&&t.status<500?t.json().then(function(t){throw new Error(t.message)}):t.text().then(function(e){throw new Error("airbrake: fetch: unexpected response: code="+t.status+" body='"+e+"'")})})}function U(t){return function(e){return function(t,e){if(Date.now()/1e3<q)return Promise.reject(B.ipRateLimited);return new Promise(function(r,n){e({url:t.url,method:t.method,body:t.body,headers:{"content-type":"application/json"},timeout:t.timeout},function(t,e,o){if(t)n(t);else{if(!e.statusCode)return t=new Error("airbrake: request: response statusCode is "+e.statusCode),void n(t);if(401!==e.statusCode)if(429!==e.statusCode)if(204!==e.statusCode)if(e.statusCode>=200&&e.statusCode<300){var i=void 0;try{i=JSON.parse(o)}catch(t){return void n(t)}r(i)}else{if(e.statusCode>=400&&e.statusCode<500){var i=void 0;try{i=JSON.parse(o)}catch(t){return void n(t)}return t=new Error(i.message),void n(t)}o=o.trim(),t=new Error("airbrake: node: unexpected response: code="+e.statusCode+" body='"+o+"'"),n(t)}else r({json:null});else{n(B.ipRateLimited);var s=e.headers["x-ratelimit-delay"];if(!s)return;var a=void 0;if("string"==typeof s)a=s;else{if(!(s instanceof Array))return;a=s[0]}var u=parseInt(a,10);u>0&&(q=Date.now()/1e3+u)}else n(B.unauthorized)}})})}(e,t)}}var q=0;function H(t){return t.request?U(t.request):C}var I=["type","name","src"];function M(t){if(!t)return"";var e=[];if(t.tagName&&e.push(t.tagName.toLowerCase()),t.id&&(e.push("#"),e.push(t.id)),t.classList&&Array.from)e.push("."),e.push(Array.from(t.classList).join("."));else if(t.className){var r=function(t){if(t.split)return t.split(" ").join(".");if(t.baseVal&&t.baseVal.split)return t.baseVal.split(" ").join(".");return console.error("unsupported HTMLElement.className type",typeof t),""}(t.className);""!==r&&(e.push("."),e.push(r))}if(t.getAttribute)for(var n=0,o=I;n<o.length;n++){var i=o[n],s=t.getAttribute(i);s&&e.push("["+i+'="'+s+'"]')}return e.join("")}function J(t){return function(e){var r;try{r=e.target}catch(t){return}if(r){var n={type:e.type};try{n.target=function(t){for(var e=[],r=t;r;){var n=M(r);if(""!==n&&(e.push(n),e.length>10))break;r=r.parentNode}return 0===e.length?String(t):e.reverse().join(" > ")}(r)}catch(t){n.target="<"+String(t)+">"}t.pushHistory(n)}}}var X=["debug","log","info","warn","error"],$=function(){function t(t){var e=this;if(void 0===t&&(t={}),this.historyMaxLen=20,this.notifiers=[],this.errors=[],this.ignoreWindowError=0,this.history=[],this.ignoreNextXHR=0,V(t.console)&&"object"==typeof console&&console.error&&(this.consoleError=console.error),"object"==typeof window){if(V(t.onerror)){var r=this,n=window.onerror;window.onerror=function(){n&&n.apply(this,arguments),r.onerror.apply(r,arguments)}}this.domEvents(),V(t.fetch)&&"function"==typeof fetch&&this.instrumentFetch(),V(t.history)&&"object"==typeof history&&this.location()}"undefined"==typeof window&&"object"==typeof process&&"function"==typeof process.on&&(process.on("uncaughtException",function(t){e.notify(t).then(function(){1===process.listeners("uncaughtException").length&&(e.consoleError&&e.consoleError("uncaught exception",t),process.exit(1))})}),process.on("unhandledRejection",function(t,r){var n=t.message||String(t);n.indexOf&&0===n.indexOf("airbrake: ")||e.notify(t).then(function(){1===process.listeners("unhandledRejection").length&&(e.consoleError&&e.consoleError("unhandled rejection",t),process.exit(1))})})),V(t.console)&&"object"==typeof console&&this.console(),V(t.xhr)&&"undefined"!=typeof XMLHttpRequest&&this.xhr()}return t.instance=function(e){return void 0===e&&(e={}),t._instance||(t._instance=new t(e)),t._instance},t.prototype.registerNotifier=function(t){this.notifiers.push(t);for(var e=0,r=this.errors;e<r.length;e++){var n=r[e];this.notifyNotifiers(n)}this.errors=[]},t.prototype.unregisterNotifier=function(t){var e=this.notifiers.indexOf(t);-1!==e&&this.notifiers.splice(e,1)},t.prototype.notify=function(t){return this.notifiers.length>0?this.notifyNotifiers(t):(this.errors.push(t),this.errors.length>this.historyMaxLen&&(this.errors=this.errors.slice(-this.historyMaxLen)),Promise.resolve(null))},t.prototype.notifyNotifiers=function(t){for(var e=[],r=0,n=this.notifiers;r<n.length;r++){var o=n[r];e.push(o.notify(t))}return Promise.all(e).then(function(t){return t[0]})},t.prototype.onerror=function(t,e,r,n,o){this.ignoreWindowError>0||(o?this.notify({error:o,context:{windowError:!0}}):e&&r&&this.notify({error:{message:t,fileName:e,lineNumber:r,columnNumber:n,noStack:!0},context:{windowError:!0}}))},t.prototype.ignoreNextWindowError=function(){var t=this;this.ignoreWindowError++,setTimeout(function(){return t.ignoreWindowError--})},t.prototype.getHistory=function(){return this.history},t.prototype.pushHistory=function(t){this.isDupState(t)?this.lastState.num?this.lastState.num++:this.lastState.num=2:(t.date||(t.date=new Date),this.history.push(t),this.lastState=t,this.history.length>this.historyMaxLen&&(this.history=this.history.slice(-this.historyMaxLen)))},t.prototype.isDupState=function(t){if(!this.lastState)return!1;for(var e in t)if(t.hasOwnProperty(e)&&"date"!==e&&t[e]!==this.lastState[e])return!1;return!0},t.prototype.domEvents=function(){var t=J(this);window.addEventListener&&(window.addEventListener("load",t),window.addEventListener("error",function(e){"error"in e||t(e)},!0)),"object"==typeof document&&document.addEventListener&&(document.addEventListener("DOMContentLoaded",t),document.addEventListener("click",t),document.addEventListener("keypress",t))},t.prototype.console=function(){for(var t=this,e=function(e){if(!(e in console))return"continue";var r=console[e],n=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];r.apply(console,n),t.pushHistory({type:"log",severity:e,arguments:n})};n.inner=r,console[e]=n},r=0,n=X;r<n.length;r++){e(n[r])}},t.prototype.unwrapConsole=function(){for(var t=0,e=X;t<e.length;t++){var r=e[t];r in console&&console[r].inner&&(console[r]=console[r].inner)}},t.prototype.instrumentFetch=function(){var t=this,e=window.fetch;window.fetch=function(r,n){var o={type:"xhr",date:new Date};return o.method=n&&n.method?n.method:"GET","string"==typeof r?o.url=r:(o.method=r.method,o.url=r.url),t.ignoreNextXHR++,setTimeout(function(){return t.ignoreNextXHR--}),e.apply(this,arguments).then(function(e){return o.statusCode=e.status,o.duration=(new Date).getTime()-o.date.getTime(),t.pushHistory(o),e}).catch(function(e){throw o.error=e,o.duration=(new Date).getTime()-o.date.getTime(),t.pushHistory(o),e})}},t.prototype.xhr=function(){var t=this,e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(r,n,o,i,s){0===t.ignoreNextXHR&&(this.__state={type:"xhr",method:r,url:n}),e.apply(this,arguments)};var r=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(e){var n=this.onreadystatechange;return this.onreadystatechange=function(e){if(4===this.readyState&&this.__state&&t.recordReq(this),n)return n.apply(this,arguments)},this.__state&&(this.__state.date=new Date),r.apply(this,arguments)}},t.prototype.recordReq=function(t){var e=t.__state;e.statusCode=t.status,e.duration=(new Date).getTime()-e.date.getTime(),this.pushHistory(e)},t.prototype.location=function(){this.lastLocation=document.location.pathname;var t=this,e=window.onpopstate;window.onpopstate=function(r){if(t.recordLocation(document.location.pathname),e)return e.apply(this,arguments)};var r=history.pushState;history.pushState=function(e,n,o){o&&t.recordLocation(o.toString()),r.apply(this,arguments)}},t.prototype.recordLocation=function(t){var e=t.indexOf("://");e>=0?(e=(t=t.slice(e+3)).indexOf("/"),t=e>=0?t.slice(e):"/"):"/"!==t.charAt(0)&&(t="/"+t),this.pushHistory({type:"location",from:this.lastLocation,to:t}),this.lastLocation=t},t}();function V(t){return void 0===t||!0===t}var W=function(){function t(t){this.m={},this.opts=t,this.url=this.opts.host+"/api/v5/projects/"+this.opts.projectId+"/routes-stats?key="+this.opts.projectKey,this.requester=H(this.opts)}return t.prototype.notifyRequest=function(t){var e=this,r=function(t,e){if(t instanceof Date&&e instanceof Date)return e.getTime()-t.getTime();if("number"==typeof t&&"number"==typeof e)return e-t;throw new Error("unsupported type: "+typeof t)}(t.start,t.end);0===r&&(r=.1);t.start=new Date(6e4*Math.floor(function(t){if(t instanceof Date)return t.getTime();if("number"==typeof t)return t;throw new Error("unsupported type: "+typeof t)}(t.start)/6e4));var n,o={method:t.method,route:t.route,statusCode:t.statusCode,time:t.start},i=JSON.stringify(o);i in this.m?n=this.m[i]:(n={count:0,sum:0,sumsq:0},this.opts.TDigest&&(n.tdigest=new this.opts.TDigest),this.m[i]=n),n.count++,n.sum+=r,n.sumsq+=r*r,n.tdigest&&n.tdigest.push(r),this.timer||(this.timer=setTimeout(function(){e.flush()},15e3))},t.prototype.flush=function(){var t=[];for(var e in this.m)if(this.m.hasOwnProperty(e)){var r=JSON.parse(e),n=p({},r,this.m[e]);n.tdigest&&(n.tdigestCentroids=this.tdigestCentroids(n.tdigest),delete n.tdigest),t.push(n)}this.m={},this.timer=null;var o=JSON.stringify({environment:this.opts.environment,routes:t}),i={method:"POST",url:this.url,body:o};this.requester(i).then(function(t){}).catch(function(t){console.error&&console.error("can not report routes stats",t)})},t.prototype.tdigestCentroids=function(t){var e=[],r=[];return t.centroids.each(function(t){e.push(t.mean),r.push(t.n)}),{mean:e,count:r}},t}();return function(){function t(t){var e,r,n=this;if(this.filters=[],this.offline=!1,this.todo=[],this.onClose=[],!t.projectId||!t.projectKey)throw new Error("airbrake: projectId and projectKey are required");this.opts=t,this.opts.host=this.opts.host||"https://api.airbrake.io",this.opts.timeout=this.opts.timeout||1e4,this.opts.keysBlacklist=this.opts.keysBlacklist||[/password/,/secret/],this.url=this.opts.host+"/api/v3/projects/"+this.opts.projectId+"/notices?key="+this.opts.projectKey,this.processor=this.opts.processor||_,this.requester=H(this.opts),this.addFilter(L),this.addFilter(function(t){var n=JSON.stringify(t.errors);return n===e?null:(r&&clearTimeout(r),e=n,r=setTimeout(function(){e=""},1e3),t)}),this.addFilter(D),this.addFilter(N),!this.opts.environment&&"undefined"!=typeof process&&process.env.NODE_ENV&&(this.opts.environment=process.env.NODE_ENV),this.opts.environment&&this.addFilter(function(t){return t.context.environment=n.opts.environment,t}),"object"==typeof window?(this.addFilter(P),window.addEventListener&&(this.onOnline=this.onOnline.bind(this),window.addEventListener("online",this.onOnline),this.onOffline=this.onOffline.bind(this),window.addEventListener("offline",this.onOffline),this.onUnhandledrejection=this.onUnhandledrejection.bind(this),window.addEventListener("unhandledrejection",this.onUnhandledrejection),this.onClose.push(function(){window.removeEventListener("online",n.onOnline),window.removeEventListener("offline",n.onOffline),window.removeEventListener("unhandledrejection",n.onUnhandledrejection)}))):this.addFilter(A);var o,i=t.instrumentation||{};void 0===typeof i.console&&(i.console=!((o=t.environment)&&o.startsWith&&o.startsWith("dev"))),this.historian=$.instance(i),this.historian.registerNotifier(this)}return t.prototype.close=function(){for(var t=0,e=this.onClose;t<e.length;t++){(0,e[t])()}this.historian.unregisterNotifier(this)},t.prototype.addFilter=function(t){this.filters.push(t)},t.prototype.notify=function(t){var e=this,r={id:"",errors:[],context:p({severity:"error"},t.context),params:t.params||{},environment:t.environment||{},session:t.session||{}};if("object"==typeof t&&void 0!==t.error||(t={error:t}),!t.error)return r.error=new Error("airbrake: got err="+JSON.stringify(t.error)+", wanted an Error"),Promise.resolve(r);if(this.opts.ignoreWindowError&&t.context&&t.context.windowError)return r.error=new Error("airbrake: window error is ignored"),Promise.resolve(r);if(this.offline)return new Promise(function(n,o){for(e.todo.push({err:t,resolve:n,reject:o});e.todo.length>100;){var i=e.todo.shift();if(void 0===i)break;r.error=new Error("airbrake: offline queue is too large"),i.resolve(r)}});var n=this.historian.getHistory();n.length>0&&(r.context.history=n);var o=this.processor(t.error);r.errors.push(o);for(var i=0,s=this.filters;i<s.length;i++){var a=(0,s[i])(r);if(null===a)return r.error=new Error("airbrake: error is filtered"),Promise.resolve(r);r=a}return r.context||(r.context={}),r.context.language="JavaScript",r.context.notifier={name:"airbrake-js",version:"2.0.0-beta.2",url:"https://github.com/airbrake/airbrake-js"},this.sendNotice(r)},t.prototype.sendNotice=function(t){var e=function(t,e){var r=void 0===e?{}:e,n=r.maxLength,o=void 0===n?64e3:n,i=r.keysBlacklist,s=void 0===i?[]:i;if(t.errors)for(var a=0;a<t.errors.length;a++){var u=new y({keysBlacklist:s});t.errors[a]=u.truncate(t.errors[a])}for(var c="",h=["context","params","environment","session"],f=0;f<8;f++){for(var p={level:f,keysBlacklist:s},l=0,d=h;l<d.length;l++)(x=t[b=d[l]])&&(t[b]=m(x,p));if((c=JSON.stringify(t)).length<o)return c}var v={json:c.slice(0,Math.floor(o/2))+"..."};h.push("errors");for(var g=0,w=h;g<w.length;g++){var b,x;(x=t[b=w[g]])&&(c=JSON.stringify(x),v[b]=c.length)}var E=new Error("airbrake: notice exceeds max length and can't be truncated");throw E.params=v,E}(t,{keysBlacklist:this.opts.keysBlacklist});if(this.opts.reporter){if("function"==typeof this.opts.reporter)return this.opts.reporter(t);console.warn("airbrake: options.reporter must be a function")}var r={method:"POST",url:this.url,body:e};return this.requester(r).then(function(e){return t.id=e.json.id,t}).catch(function(e){return t.error=e,t})},t.prototype.wrap=function(t,e){if(void 0===e&&(e=[]),t._airbrake)return t;var r=this,n=function(){var e=Array.prototype.slice.call(arguments),n=r.wrapArguments(e);try{return t.apply(this,n)}catch(t){throw r.notify({error:t,params:{arguments:e}}),this.historian.ignoreNextWindowError(),t}};for(var o in t)t.hasOwnProperty(o)&&(n[o]=t[o]);for(var i=0,s=e;i<s.length;i++){o=s[i];t.hasOwnProperty(o)&&(n[o]=t[o])}return n._airbrake=!0,n.inner=t,n},t.prototype.wrapArguments=function(t){for(var e=0;e<t.length;e++){var r=t[e];"function"==typeof r&&(t[e]=this.wrap(r))}return t},t.prototype.call=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this.wrap(t);return n.apply(this,Array.prototype.slice.call(arguments,1))},t.prototype.onerror=function(){this.historian.onerror.apply(this.historian,arguments)},t.prototype.notifyRequest=function(t){this.opts.TDigest&&(this.routes||(this.routes=new W(this.opts)),this.routes.notifyRequest(t))},t.prototype.onOnline=function(){this.offline=!1;for(var t=function(t){e.notify(t.err).then(function(e){t.resolve(e)})},e=this,r=0,n=this.todo;r<n.length;r++){t(n[r])}this.todo=[]},t.prototype.onOffline=function(){this.offline=!0},t.prototype.onUnhandledrejection=function(t){var e=t.reason||t.detail&&t.detail.reason;if(e){var r=e.message||String(e);r.indexOf&&0===r.indexOf("airbrake: ")||this.notify(e)}},t}()}();
//# sourceMappingURL=airbrake.iife.min.js.map
