{"version":3,"file":"hapi.js","sources":["../../src/instrumentation/hapi.ts"],"sourcesContent":["import Notifier from '../notifier';\n\nfunction makeHandler(client: Notifier) {\n  let fn: any = (server, _options, next): void => {\n    server.on('request-error', (req, err: Error): void => {\n      let url =\n        req.connection.info.protocol + '://' + req.headers.host + req.path;\n      let notice: any = {\n        error: err,\n        context: {\n          userAddr: req.info.remoteAddress,\n          userAgent: req.headers['user-agent'],\n          url,\n          route: req.route.path,\n          httpMethod: req.method,\n          component: 'hapi',\n          action: req.route.settings.handler.name,\n        },\n      };\n      let referer = req.headers.referer;\n      if (referer) {\n        notice.context.referer = referer;\n      }\n\n      client.notify(notice);\n    });\n    next();\n  };\n  fn.attributes = {\n    name: 'airbrake-js',\n    version: '1.0.0',\n  };\n  return fn;\n}\n\nexport default makeHandler;\n"],"names":[],"mappings":"AAEA,SAAS,WAAW,CAAC,MAAgB;IACnC,IAAI,EAAE,GAAQ,UAAC,MAAM,EAAE,QAAQ,EAAE,IAAI;QACnC,MAAM,CAAC,EAAE,CAAC,eAAe,EAAE,UAAC,GAAG,EAAE,GAAU;YACzC,IAAI,GAAG,GACL,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,GAAG,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;YACrE,IAAI,MAAM,GAAQ;gBAChB,KAAK,EAAE,GAAG;gBACV,OAAO,EAAE;oBACP,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,aAAa;oBAChC,SAAS,EAAE,GAAG,CAAC,OAAO,CAAC,YAAY,CAAC;oBACpC,GAAG,KAAA;oBACH,KAAK,EAAE,GAAG,CAAC,KAAK,CAAC,IAAI;oBACrB,UAAU,EAAE,GAAG,CAAC,MAAM;oBACtB,SAAS,EAAE,MAAM;oBACjB,MAAM,EAAE,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI;iBACxC;aACF,CAAC;YACF,IAAI,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC;YAClC,IAAI,OAAO,EAAE;gBACX,MAAM,CAAC,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC;aAClC;YAED,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;SACvB,CAAC,CAAC;QACH,IAAI,EAAE,CAAC;KACR,CAAC;IACF,EAAE,CAAC,UAAU,GAAG;QACd,IAAI,EAAE,aAAa;QACnB,OAAO,EAAE,OAAO;KACjB,CAAC;IACF,OAAO,EAAE,CAAC;CACX;;;;"}